### Config Options ###

# Enable mouse mode
set -g mouse on

# Set the default terminal type to xterm because not all applications
# appear to get along with 256-color modes.  We can run tmux in 256
# color mode and turn it on selectively for apps that support it.
set -g default-terminal "screen-256color"

# Increase history
set -g history-limit 100000

# Set base index of panes and windows to 1
set -g base-index 1
setw -g pane-base-index 1

# Enable vi keybindings in copy mode
setw -g mode-keys vi

# Force tmux to use system clipboard.
unbind -T copy-mode-vi Space; #Default for begin-selection
unbind -T copy-mode-vi Enter; #Default for copy-selection

# Setup 'v' to begin selection as in Vim.
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "reattach-to-user-namespace pbcopy"

# Fix vim cursor issue when changing modes.
set -g -a terminal-overrides ',*:Ss=\E[%p1%d q:Se=\E[2 q'


### Key Bindings ###

# Set global shortcut to Ctrl+Space
unbind C-b
set -g prefix C-Space

# Reloading config
unbind r
bind r source-file ~/.tmux.conf \; display "Reloaded ~/.tmux.conf"

# Splitting panes
unbind v
unbind h

unbind % # Split vertically
unbind '"' # Split horizontally

bind v split-window -h -c "#{pane_current_path}"
bind h split-window -v -c "#{pane_current_path}"

# Reordering windows
bind-key -n C-S-Left swap-window -t -1
bind-key -n C-S-Right swap-window -t +1

# Opening new windows to remote hosts.
unbind p
bind p command-prompt -p "SSH to host:" "if-shell '[ -n \"%%\" ]' 'new-window -n \"%1\" \"/usr/bin/ssh %1\"'"

# Navigating between panes
bind -n C-h select-pane -L
bind -n C-j select-pane -D
bind -n C-k select-pane -U
bind -n C-l select-pane -R

# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'
tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\'  'select-pane -l'"
if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\\\'  'select-pane -l'"

bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R
bind-key -T copy-mode-vi 'C-\' select-pane -l

# Window management
unbind n  # DEFAULT KEY: Move to next window
unbind w  # DEFAULT KEY: change current window interactively

bind n command-prompt "rename-window '%%'"
bind w new-window -c "#{pane_current_path}"

bind -n M-j previous-window
bind -n M-k next-window


### Color Scheme

# Statusbar
set -g status-position bottom
set -g status-style fg=colour136,bg=colour235 #yellow and base02
set -g status-left ''
set -g status-right '#{?client_prefix,#[fg=red]prefix pressed ..,#[fg=brightwhite]#{cmus_status} | #H} '
set -g status-justify left
set -g status-interval 2
set -g status-right-length 250
set -g status-left-length 20

# Messaging
set -g message-command-style fg=blue,bg=black
set -g message-style fg=white,bg=brightred,bold
# set -g message-style fg=brightred,bg=black #orange and base01

# Window mode
setw -g mode-style bg=green,fg=black

# Window status
setw -g window-status-format " #F#I:#W#F "
setw -g window-status-current-format " #F#I:#W#F "
setw -g window-status-current-format ' #I#[fg=brightwhite]:#[fg=brightwhite]#W#[fg=blue]#F '
# setw -g window-status-format "#[fg=magenta]#[bg=black] #I #[bg=cyan]#[fg=white] #W "
setw -g window-status-format ' #I#[fg=colour251]:#[fg=colour251]#W#[fg=black]#F '
# setw -g window-status-bell-style fg=white,bg=red,bold
# setw -g window-status-bell-style fg=black,bg=red #base02, red
setw -g window-status-bell-style fg=colour235,bg=colour160 #base02, red
setw -g window-status-current-format "#[bg=magenta]#[fg=white] #I #[fg=white]#[bg=blue] #W "
setw -g window-status-current-style fg=colour166,bg=default #orange and default
#setw -g window-status-current-style bright
# setw -g window-status-current-style bg=black,fg=yellow,dim
# setw -g window-status-style fg=brightblue,bg=default #base0 and default
setw -g window-status-style fg=colour244,bg=default #base0 and default
#setw -g window-status-style dim
# setw -g window-status-style bg=green,fg=black,reverse

# Loud or quiet?
set -g visual-activity off
set -g visual-bell off
set -g visual-silence off
setw -g monitor-activity off
set -g bell-action none

# The modes
# setw -g clock-mode-colour red
setw -g mode-style fg=red,bg=white,bold
setw -g clock-mode-colour colour64 #green

# The panes
# set -g pane-border-style fg=black #base02
# set -g pane-active-border-style fg=brightgreen #base01
set -g pane-border-style fg=colour235 #base02
set -g pane-active-border-style fg=magenta #base01
# set -g display-panes-active-colour blue #blue
# set -g display-panes-colour brightred #orang
set -g display-panes-active-colour colour33 #blue
set -g display-panes-colour colour166 #orange

# Tmux cmus plugin
run-shell ~/.dotfiles/tmux/tmux-cmus/tmux-cmus.tmux
