#!/usr/bin/env bash

is_playing=$(/usr/local/bin/cmus-remote --query | grep 'status playing')

if [[ -z "$is_playing" ]]; then
    echo "CMUS Paused"
    exit
fi

track=$(/usr/local/bin/cmus-remote -C "format_print %t")
track_formatted=$(echo "$track" | awk -v len=30 '{ if (length($0) > len) print substr($0, 1, len-3) "..."; else print; }')
played=$(/usr/local/bin/cmus-remote -C 'format_print (%{position}/%d)')
now_playing=$(/usr/local/bin/cmus-remote -C 'format_print %A\ -\ %l\ -\ %n.\ ')

echo "${now_playing} ${track_formatted} ${played}"
